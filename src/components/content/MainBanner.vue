<template>
  <!-- =======================
    Main Banner START -->
  <section class="pt-3 pt-lg-5">
    <div class="container">
      <!-- Content and Image START -->
      <div class="row g-4 g-lg-5">
        <!-- Content -->
        <div class="col-lg-6 position-relative mb-4 mb-md-0">
          <!-- Title -->
          <h1 class="mb-4 mt-md-5 display-6">
            بزرگترین مرکز فروش اقساطی کالا و خدمات
          </h1>
          <!-- Info -->
          <p class="mb-4">با بیشترین تنوع اقساط در کشور</p>

          <!-- Buttons -->
          <div class="hstack gap-4 flex-wrap align-items-center">
            <!-- Button -->
            <a
              href="https://gestshop.ir/gestshop.apk"
              class="btn btn-primary-soft mb-0"
              >دانلود اپلیکیشن قسط شاپ</a
            >
            <!-- Story button -->
          </div>
        </div>

        <!-- Image -->
        <div class="col-lg-6 position-relative">
          <img src="@/assets/images/bg/06.jpg" class="rounded" alt="" />

          <!-- Svg decoration -->
          <figure class="position-absolute end-0 bottom-0">
            <svg width="163px" height="163px" viewBox="0 0 163 163">
              <path
                class="fill-warning"
                d="M145.6,66.2c-0.9-0.3-1.6,0.2-2.1-0.4c-0.5-0.7-1-1.5-1-2.4c0-3.1,0.1-6.2,0-9.3c0-0.7,0.3-1.3,0.5-1.9 c0.8-1.6,1.6-3.2,2.7-4.5c0.5-0.6,1.2-1.2,2-1.5c0.4-0.2,0.8,0.4,1.3-0.1c0.4-0.4,1,0.7,1.6,0.7c0.4,1-0.4,1.5-1,2.1 c0.7,0.3,1.4,0.3,2.1,0.7c0.6,0.4,1.2,0.7,1,1.5c-0.2,1,0.6,1.3,1,1.9c-0.2,0.3-0.6,0.4-0.5,0.8c1.2,3.2,0.3,5.4-0.7,8.1 c-0.3,0.7-0.7,1.6-0.7,2.2c-0.1,1.5-1.2,2.7-1.4,4.1c-0.2,1.1-0.9,1.7-2.1,1.6c-0.2,0-0.4,0.5-1,0.4c-0.2-0.2-0.7-0.5-0.7-0.8 c0-1-0.1-1.7-1.1-2.1C145.5,67.2,145.6,66.6,145.6,66.2"
              />
              <path
                class="fill-warning"
                d="M94.3,143.5c1.1,0.3,2.4-0.5,3.2,0.7c-0.4,0.7-0.7,1.4-1,2.1c0.5,0.5,0.7,0.2,1.2,0.1c1.6-0.6,2-0.4,2.5,1.2 c0.1,0.2,0,0.6,0.3,0.6c1.8,0.4,1.4,2.2,2.1,3.2c-0.8,0.9,0.5,1.8,0.1,2.6c-0.5,0.8-0.3,2-1.3,2.6c-0.3,0.2-0.1,0.5-0.2,0.7 c-0.3,2.1-1.2,3.7-3.4,4.4c-0.3,0.1-0.4,0.6-1,0.4c-0.3-0.6-0.6-1.3-1-1.9c-0.5-0.2-1.5,0.3-1.4-1h-3c-0.2-1.4,0-2.9-1.1-3.9 c-0.1-0.1-0.1-0.4,0-0.5c0.7-1.2,0.2-2.6,0.7-3.8c0.3-0.6,0.4-1,0.1-1.6c-0.9-1.3,0-2.4,0.7-3.3C92.5,145,93.4,144.3,94.3,143.5"
              />
              <path
                class="fill-warning"
                d="M119.6,77.3c-0.4,0.8-1.1,0.6-2,0.8c0.2,1.1-0.4,2.2,0.5,3.3c-0.8,0-0.8,0-1.2-0.3c-0.6,0.3-0.8,1-1.2,1.6 c0.1-1.9-0.6-3.2-2-4.1c-0.6-0.1-0.7,0.3-1,0.5c-1-1.9-1-2.8-0.2-7.7c0.4-2.5,1.7-4.6,3.6-6.8c0.6-0.1,1.5,1.5,2.3,0 c0.8,1.5-0.7,2.3-0.8,3.7c0.8-0.4,1.6-0.7,2.4-0.4c0.4,0.4-0.1,1,0.3,1.4c0.8,0.6,1.4,1.3,0.4,2.3c1.1,0.8-0.3,1.5-0.1,2.4 c0.2,0.8,0,1.7,0,2.5c-0.8-0.2-1-1.1-1.8-1C118.2,76.4,119.5,76.5,119.6,77.3"
              />
              <path
                class="fill-warning"
                d="M25,131c-0.3-0.6-1.2-0.3-1.7-0.5v-1.2c-0.1-0.1-0.1-0.2-0.2-0.2c-1.4,0.5-2.2-1-3.4-1.2 c-1.2-0.1-1.9-1-2.1-2.2c-0.1-0.5,0.1-0.8,0.5-1.1c-2-1.7-0.8-3.4-0.1-5.1c0.8-2.2,2.6-2.5,4.6-2.4c0.4,1.1,0.2,2-0.6,2.7 c1.5,1,2-0.5,3-0.8c0.3,0.6,0.6,1.2,0.9,1.6c0,0.6-0.8,0.8-0.4,1.4c0.7,0.8,0.9-0.5,1.7-0.3c1,0.9,0.9,2.2,0.8,3.4 c0.4,0.1,0.6,0.2,1,0.3c-0.1,0.6-1,0.8-1,1.5c0,0.8,0.8,0.2,1,0.7C27.7,128.8,26.9,130.3,25,131"
              />
              <path
                class="fill-warning"
                d="M84.9,95H87c0.4,0.4,0.3,1.6-0.3,2.8c1.2,1,1.7-0.5,2.4-0.8c0.8,0,0.8,0.6,1.2,0.7c0.2,0.8-0.7,0.9-0.4,1.7 c0.5,0.3,1.7,0,1.9,0.9c0.2,0.7,0.3,1.5-0.5,2.1c0.3,0.1,0.6,0.2,0.9,0.3c-0.1,0.7-1.1,1.3-0.5,2.2c-1.1,1.5-3,2.1-4.4,3.3 c-0.3,0.2-0.8,1-1.5,0.5c-0.3-0.4,0.4-0.4,0.3-0.8c-0.7-0.5-1.6,0.1-2.4-0.3c-0.2-0.6,0.1-1.4-0.8-1.8c-1.1,0.5-2.2,0.7-3.2-0.8 c1.3-0.8,3-1.1,3.2-3c-1,0-1.7,0.9-2.7,1c-0.2-0.2-0.5-0.4-0.8-0.7c-0.1-0.1,0.1-0.1,0.2-0.3c0.6-1.1,2.4-1,2.5-2.5 c1.2-0.5,1.1-1.7,1.3-2.5C83.8,96.3,84.3,95.7,84.9,95"
              />
              <path
                class="fill-warning"
                d="M41.2,153.9c0.3-0.7,0.9-0.8,0.4-1.6c-0.3-0.3-1.1,0.2-1.8-0.2c0-0.2-0.1-0.4-0.1-0.7c-0.1-0.1-0.2-0.2-0.3,0 c-0.3,0.4-0.7,0.4-1.1,0.4c-1.3,0-1.5-0.4-1.6-1.7c0-0.6,0.4-0.8,0.5-1.4c-0.4,0-0.8-0.1-1.4-0.1c-0.4-1.9,0.7-3.6,1.1-5.4 c0.2-0.9,1.6-1.3,2.7-1.3c0.4,0.2,0.3,0.6,0.3,0.7c0.2,0.4,0.3,0.3,0.4,0.1c0.6-0.5,1.3-0.6,1.7,0.1c0.5,0.7,1.1,0.6,1.8,0.7 c0.4,0.4,0.1,0.8,0.2,1.2c0.3,0.4,0.8,0.2,1.3,0.3c1,0.7,0.5,2.1,1.3,2.9C43.8,152.3,43.1,153.1,41.2,153.9"
              />
              <path
                class="fill-warning"
                d="M70.9,43.4c-0.3-1.4-1.2-1.8-2.6-1.5c-1.2-2.3-0.8-4.8-0.5-7.2c0.1-0.5,0.4-1.1,0.3-1.7 c-0.2-1.1,0.5-1.9,0.6-2.9c0.1-0.7,1.3-0.9,2-1.3c0.9,0.8,0.9,0.8,1.2,2c0.3,0,0.6,0,0.4,0c1.3,0,0.8,0.9,1.3,1.2 c0.3,0.1,0.8,0.5,0.7,1c-0.2,0.8,1,1.4,0.5,2.1c-0.5,0.7-0.2,1.5-0.5,2.1c-0.8,1.5-1,3.2-1.5,4.8C72.6,43.1,72,43.4,70.9,43.4"
              />
              <path
                class="fill-warning"
                d="M125.4,118.4c-0.4-0.3-0.6-0.7-1.3-0.8c-1.6-0.1-1.6-0.2-1.9-1.9c-1.1-0.4-2.2,0-3.2,0.4 c-0.5-0.5-0.2-0.9-0.4-1.4c0.4-0.1,0.7-0.2,1-0.4v-3c-0.5,0.2-1,0.3-1.7,0.5c-0.3,0-0.4-0.6-0.8-0.7c0.6-1.5,1.8-2.4,2.8-3.5 c1.3,0.3,2.6-1.1,3.8,0.4c0,0.1-0.1,1.8,0,2.1c-0.2,0-0.5,0.1-0.7,0.1c-0.2,0-0.3,0-0.5,0c-0.4,0.4-0.1,1.1-0.7,1.5 c1.3-0.5,2.4-1,3.3-2c0.4,0.4,0.7,0.8,1.4,0.6c-1.1,0.9,0.4,2.1-1,2.9c1,0,1.1-0.6,1.5-0.8c0.4-0.1,0.8-0.1,1.2-0.2 c0.5,1,1.1,1.8,0.6,3c-0.7,0.6-2.2,0.4-2.5,2.1c1.2-0.2,1.9-0.9,2.5-1.5c0.7,0.1,0.7,0.5,0.6,0.8c-1.3-0.1-1.2,1.5-2.3,1.9 c-0.9,0.3-1.6,1-2.7,1.8C124.7,119.5,125.1,119,125.4,118.4"
              />
              <path
                class="fill-warning"
                d="M101.7,41c-0.3,0.3-0.6,0.6-0.9,0.9c0.9,0.6-0.9,1.6,0.4,2.1c-2,2.3-2,2.4-2.1,4.8h-2.4c-0.2-0.1,0-0.5-0.2-0.8 c-2.4-0.3-2.9-0.8-3-3.3c0-0.6,0.2-1.4-0.5-1.8c0.5-0.7,0.2-1.6,0.7-2.4c1-1.5,2.3-2.7,3.5-3.9c0.5-0.2,1-0.1,1.4,0 c0.2,1-1.1,1.6-0.2,2.6c0.3-0.4,0.6-0.8,0.9-1.3C100.2,39.2,101.7,39.5,101.7,41"
              />
              <path
                class="fill-warning"
                d="M140.4,5.4c-0.4,0.6-1.2-0.1-1.5,0.6c0.7,0.4,1.5,0.1,2.3,0.2c0.3,1.1,0.9,2.1,1.3,3.2c0.9,2.4,0.3,4.4-0.6,6.6 c-0.4,0.9-0.9,1.2-1.9,1c-0.2-0.5-0.5-1.2-0.9-1.9c-0.6-0.2-1.5,0-1.9-1c0.1-1.7,0.1-3.6-1.1-5.2c0.4-0.7,0.7-1.3,1.1-1.9 c-0.3-0.1-0.6-0.2-1-0.4c0.2-0.8,0.5-1.6,1.3-2.3h2.2C140,4.6,140.5,4.8,140.4,5.4"
              />
              <path
                class="fill-warning"
                d="M65.7,68.8c-0.4,0.6-0.9,0.4-1.4,0.4c-1.2-1.1-0.4-2.9-1.4-4.1c1.5-3,1.5-3,4.1-4.2c0.5,0.1,0.8,0.5,1,1 c0.1,0.6-0.8,0.7-0.5,1.3c0.5,0.6,0.9,0.2,1.2-0.2c1.5,0.6,1.1,2.5,2.4,3.3c-0.1,1.1,0.2,2.2-0.2,3.2L69,72.2c-0.3,0-0.7,0-1,0 c-0.3-0.5-0.9-2.2-0.8-2.4C66.7,69.6,66.2,69.2,65.7,68.8"
              />
              <path
                class="fill-warning"
                d="M37.5,69.7c-0.5,0.2,0,0.9-0.4,1c-0.7,0.2-1-0.2-1.2-0.6c-0.4-0.7,0.1-1.6-0.2-2.2c-0.5-0.7-0.6-1.2-0.1-2 c0.5-0.6,0.2-1.5,0.6-2.3c0.9-2,0.9-2.1,3-2.1c0.1,0.1,0.2,0.1,0.2,0.2c0,0.3,0,0.7,0,1.1c0.7,0.4,1.7,0.1,2.1,1.3 c0.3,0.9,1.2,1.5,1,2.7c-0.2,0.9,0.1,1.8-0.8,2.5c-0.4,0.4-0.8,1.1-0.8,2c0,0.6-0.5,1-1.2,1.1c-0.6,0.1-1-0.3-1.2-0.7 C38,71,37.8,70.3,37.5,69.7"
              />
              <path
                class="fill-warning"
                d="M53.9,87.8c0.7,0,1.4,0,2.1,0c0.5,0.3,0.1,1,0.4,1.4c0.4,0.3,0.8,0.1,1.2,0.2c0.6,1.2,1.4,2.4,1.7,3.6 c0.4,1.4-0.2,2.7-0.7,4c-1,0.4-1.5-0.4-2.1-0.9c-0.7,0-1.4,0-2.1,0c-0.4-1-0.8-1.8-2.1-1.5c-0.6-0.7,0.2-1.8-0.7-2.3 c0.5-0.6,0.9-1.3,1-2.1C52.8,89.2,53.2,88.5,53.9,87.8"
              />
              <path
                class="fill-warning"
                d="M0.1,95.7c0.9-1.3,2.3-1.7,3.8-1.8c1,1.2-0.7,1.5-0.8,2.3c1.1,1,2-0.7,3.1,0c0.6,0.6-0.2,0.8-0.3,1.2 c0.4,0.5,1,0,1.4,0.3c0.4,1.1-0.3,2.3,0.6,3.3c-0.8,0.8-0.7,2.2-1.9,2.8c-1.1-0.2-1.8-1-2.6-1.7c-0.7-0.6-1.9-0.5-2.6-1.9 C1,98.9-0.4,97.4,0.1,95.7"
              />
              <path
                class="fill-warning"
                d="M155.5,91.5c-0.9-0.5-1.7-0.7-2.3-1.6c0.4-0.2,0.8-0.5,1.2-0.7c-1.2-0.4-2.1,0.7-3.1,0c0.6-1,1.8-1,2.5-1.7 c0.1-0.6-0.3-0.6-0.7-0.7c-0.7-0.2-0.9,0.9-1.6,0.5c-0.3-0.3-0.4-0.7-0.1-0.9c1.7-1,3-2.3,4.5-3.5c0.9-0.7,1.1-0.9,2.5-1.2 c-0.1,0.5-0.6,0.7-0.9,1.1c0.7,0.7,1.3,0.1,1.9-0.2c0.1,1.1,0.9,1.9,0.5,3.4C158.3,87.4,157.4,89.8,155.5,91.5"
              />
            </svg>
          </figure>

          <!-- Support guid -->
          <div class="position-absolute top-0 end-0 z-index-1 mt-n4">
            <div
              class="bg-blur border border-light rounded-3 text-center shadow-lg p-3"
            >
              <!-- Title -->
              <i class="bi bi-headset text-danger fs-3"></i>
              <h5 class="text-dark mb-1">24 / 7</h5>
              <h6 class="text-dark fw-light small mb-0">پشتیبانی و راهنمایی</h6>
            </div>
          </div>

          <!-- Round image group -->
          <div
            class="vstack gap-5 align-items-center position-absolute top-0 start-0 d-none d-md-flex mt-4 ms-n3"
          >
            <img
              class="icon-lg shadow-lg border border-3 border-white rounded-circle"
              src="@/assets/images/category/hotel/4by3/11.jpg"
              alt="avatar"
            />
            <img
              class="icon-xl shadow-lg border border-3 border-white rounded-circle"
              src="@/assets/images/category/hotel/4by3/12.jpg"
              alt="avatar"
            />
          </div>
        </div>
      </div>
      <!-- Content and Image END -->

      <!-- Search START -->
      <div class="row">
        <div class="col-xl-10 position-relative mt-n3 mt-xl-n9">
          <!-- Title -->
          <h6 class="d-none d-xl-block mb-3">محاسبه گر اقساط</h6>

          <!-- Booking from START -->
          <form
            class="card shadow rounded-3 position-relative p-4 pe-md-5 pb-5 pb-md-4"
          >
            <div class="row g-4 align-items-center">
              <div class="col-lg-3">
                <div
                  class="form-control-border form-control-transparent form-fs-md d-flex"
                >
                  <!-- Icon -->

                  <!-- درخواستی -->
                  <div class="flex-grow-1">
                    <div
                      class="form-control-border form-control-transparent form-fs-md"
                    >
                      <label class="form-label">سقف خرید</label>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="سقف خرید"
                        @input="updateTopBuy"
                        :value="topBuy"
                        :style="amountInvalid == true ? { border:'1px solid red' } : ''"
                      />
                    </div>
                    <p class="text-danger mb-0 mt-2" style="font-size:11px" v-if="amountInvalid == true">مبلغ درخواستی بیش از حد مجاز میباشد</p>
                  </div>
                </div>
              </div>


              <!-- Location -->
              <div class="col-lg-3">
                <div
                  class="form-control-border form-control-transparent form-fs-md d-flex"
                >
                  <div class="flex-grow-1">
                    <div class="form-control-border form-control-transparent form-fs-md">
                      <label class="form-label">اعتبار درخواست</label>
                      <input
                        type="text"
                        class="form-control !bg-gray-300"
                        placeholder="اعتبار درخواست"
                        @input="updateRequestAmount"
                        :value="requestedAmount"
                        disabled
                        :style="amountInvalid == true ? { border:'1px solid red' } : ''"
                      />
                    </div>
                    <p class="text-danger mb-0 mt-2" style="font-size:11px" v-if="amountInvalid == true">مبلغ درخواستی بیش از حد مجاز میباشد</p>
                  </div>
                </div>
              </div>

              <!-- Check in -->
              <div class="col-lg-3">
                <div class="d-flex">
                  <div
                    class="form-control-border form-control-transparent form-fs-md"
                  >
                    <label class="form-label" >دوره بازگشت</label>
                    <select name="select-type" class="form-control" v-model="returnPeriod">
                        <option value="6">6 ماه</option>
                        <option value="9">9 ماه</option>
                        <option value="12">12 ماه</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Guest -->
              <div class="col-lg-3">
                <div
                  class="form-control-border form-control-transparent form-fs-md d-flex"
                >
                  <div class="w-100">
                    <label class="form-label">گام پرداخت</label>
                    <select name="select-type" class="form-control" v-model="paymentStep">
                        <option value="1">1 ماه</option>
                        <option value="2">2 ماه</option>
                        <option value="3">3 ماه</option>
                    </select>
                  </div>
                </div>
              </div>

              

              <div class="row g-3 align-items-center mt-0" >
                <div class="col-lg-3">
                  <div>
                    <p class="mb-0">پیش پرداخت</p>
                    <p class="text-primary" style="font-size:14px;font-weight:bold">{{ rial_separate(beforePay) }} ریال</p>
                  </div>
                </div>
                <div class="col-lg-3">
                  <div>
                    <p class="mb-0">کل سود پرداختی طی دوره</p>
                    <p class="text-primary" style="font-size:14px;font-weight:bold">{{ rial_separate(calcData.totalInterest) }} ریال</p>
                  </div>
                </div>
                <div class="col-lg-3">
                  <div>
                    <p class="mb-0"> جمع باز پرداخت </p>
                    <p class="text-primary" style="font-size:14px;font-weight:bold">{{ rial_separate(calcData.totalPayment) }} ریال</p>
                  </div>
                </div>
                <div class="col-lg-3">
                  <div>
                    <p class="mb-0"> مبلغ هر قسط</p>
                    <p class="text-primary" style="font-size:14px;font-weight:bold">{{ rial_separate(calcData.monthlyPayment) }} ریال</p>
                  </div>
                </div>

                <div class="col-lg-3">
                  <div
                    class="form-control-border form-control-transparent form-fs-md d-flex"
                  >
                    <div class="w-100">
                      <label class="form-label"></label>
                      <div class="me-2">
                        <button @click="doAgsatBuy()" type="button" class="btn btn-primary mb-0">خرید اقساطی</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
          <!-- Booking from END -->
        </div>
      </div>
      <!-- Search END -->
    </div>
  </section>
  <!-- =======================
    Main Banner END -->
</template>

<script>
export default {
  name: "MainBanner",
  data: () => ({
    topBuy: 900000000,
    beforePay: 0,
    requestedAmount: 0,
    returnPeriod: 6,
    paymentStep: 1,
    amountInvalid: false,
    calcData: {
      monthlyPayment: null,
      monthly: null,
      totalInterest: null,
      totalPayment: null
    }
  }),
  watch: {
    topBuy(newValue , oldValue){
      this.clearCalcData()
    
      this.doCalculate()
    },
    returnPeriod(newValue , oldValue){
      this.clearCalcData()

      this.doCalculate()
    },
    paymentStep(newValue , oldValue){
      this.clearCalcData()

      this.doCalculate()
    }
  },
  async mounted(){
    await this.doCalculate()
  },  
  computed: {
    authuser(){
      return this.$store.getters.get_authuser
    } 
  },
  methods: {
    doCalculate(){
      if(this.topBuy != ''){
        if(this.topBuy <= 900000000){
          this.amountInvalid = false

          const befor_payment = (this.topBuy * 20) / 100
          this.beforePay = befor_payment


          const requested_amount = this.topBuy - befor_payment
          this.requestedAmount = requested_amount


          const principal = parseFloat(this.requestedAmount); 

          const calculatedInterest = (principal*27) / 100;
          this.calcData.totalInterest = calculatedInterest;

          const calculatedPayments = this.requestedAmount + calculatedInterest;
          this.calcData.totalPayment = calculatedPayments

          this.calcData.monthlyPayment = Math.ceil(calculatedPayments / this.returnPeriod) * this.paymentStep

        }else{
          this.amountInvalid = true
        }
      }else{
        alert("مبلغ درخواستی را تعیین کنید")
      }
    },
    doAgsatBuy() {
      if(this.authuser != null){
        const agsatRequestData = {
          requestedAmount: this.requestedAmount,
          returnPeriod: this.returnPeriod,
          paymentStep: this.paymentStep,
          monthlyPayment: this.calcData.monthlyPayment,
          totalInterest: this.calcData.totalInterest,
          totalPayment: this.calcData.totalPayment,
        }
        this.$cookies.set("gest_detail", JSON.stringify(agsatRequestData), 60*60*24)
        this.$router.push("/userpanel")
      }else{
        this.$router.push("/userpanel")
      }
    },
    updateTopBuy(e){
      this.topBuy = e.target.value
    },    
    rial_separate(Number) {
      Number += "";
      Number = Number.replace(",", "");
      let x = Number.split(".");
      let y = x[0];
      let z = x.length > 1 ? "." + x[1] : "";
      var rgx = /(\d+)(\d{3})/;
      while (rgx.test(y)) y = y.replace(rgx, "$1" + "," + "$2");
      return y + z;
    },
    clearCalcData(){
      this.calcData.monthlyPayment = null
      this.calcData.monthly = null
      this.calcData.totalInterest = null
      this.calcData.totalPayment = null
    }
  }
}
</script>
